# Welone Digital Atelier Portfolio

Многостраничное портфолио с анимациями, пасхалками и встроенной админ-панелью.

## Что добавлено

- Метрики админки: уникальные посетители за сегодня, повторные посещения, среднее время просмотра, найденные пасхалки
- Подсчет среднего времени просмотра страниц
- Аналитика по найденным пасхалкам
- Сохранение заявок из формы `contact.html`
- Админ-панель `admin.html` для ключевой статистики
- Отдельная страница заявок `admin-leads.html` с подробным списком и сменой статусов
- API и раздача статики через `server.js` (без внешних зависимостей)

## Запуск

1. Откройте PowerShell в папке проекта.
2. Установите переменные окружения:

```powershell
$env:ADMIN_PASSWORD="СЛОЖНЫЙ_ПАРОЛЬ"
$env:TOKEN_SECRET="ДЛИННЫЙ_СЕКРЕТ_ДЛЯ_ТОКЕНОВ"
```

3. Запустите сервер:

```powershell
node server.js
```

4. Откройте сайт:

- Основной сайт: `http://localhost:3000/`
- Админ-панель: `http://localhost:3000/admin.html`
- Все заявки: `http://localhost:3000/admin-leads.html`

## Как работает

- Визиты отправляются из `script.js` в `POST /api/visit`.
- Время просмотра отправляется в `POST /api/engagement`.
- Найденные пасхалки отправляются в `POST /api/secret`.
- Форма в `contact.html` отправляет заявку в `POST /api/leads`.
- В админке:
  - логин: `POST /api/admin/login`
  - статистика: `GET /api/admin/stats`
  - заявки: `GET /api/admin/leads`
  - смена статуса: `PATCH /api/admin/leads/:id`

## Хранилище данных

Данные сохраняются в `data/site-data.json`.

## Локальные ассеты пасхалок

Модели для анимаций пасхалок сохранены локально:

- `assets/models/rocket.svg`
- `assets/models/mario.svg`

## Важно

Если открыть HTML-файлы напрямую (`file://`), API недоступен. Используйте запуск через `node server.js`.

## Автопроверка качества (одна команда)

Для полной smoke-проверки сайта (страницы + API + админ-поток):

```powershell
node qa-smoke.js
```

Что проверяет:

- доступность всех HTML-страниц
- `/api/health`, `/api/visit`, `/api/engagement`, `/api/secret`, `/api/leads`
- защиту админ-роутов без токена
- логин администратора, загрузку статистики и заявок
- обновление статуса заявки через `PATCH /api/admin/leads/:id`

Скрипт запускает временный сервер на порту `3199` и автоматически восстанавливает `data/site-data.json` после теста, чтобы не оставлять тестовые данные.

Для запуска двойным кликом в Windows можно использовать `qa-smoke.bat`.
